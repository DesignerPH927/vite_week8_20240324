import{S as D}from"./sweetalert2.all-gQaNXFuB.js";import{_ as k,o as l,c as o,a as t,t as a,h as v,F as h,g as y,j as x,l as M,b as O,w as f,m as C,r as p,d as m,n as V}from"./index-6BvTerDF.js";import{u as T}from"./statusStore-N0jbiZgM.js";import{m as P}from"./modal-zhVd5Gm4.js";import{D as E}from"./DelModal--U7SkCiH.js";import{P as S}from"./PaginationView-VIKG9F-S.js";const U={props:["orderData","updateOrderModal"],mixins:[P],data(){return{tempOrderData:{}}},watch:{orderData(){this.tempOrderData=this.orderData}}},A={class:"modal fade",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},R={class:"modal-dialog modal-dialog-scrollable"},B={class:"modal-content"},N=t("div",{class:"modal-header bg-warning"},[t("h1",{class:"modal-title fs-5 text-white",id:"exampleModalLabel"}," 檢視資訊 "),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),j={class:"modal-body"},q=t("ul",{class:"nav nav-tabs row",id:"myTab",role:"tablist"},[t("li",{class:"nav-item col-md-6",role:"presentation"},[t("button",{class:"nav-link active w-100 text-dark",id:"home-tab","data-bs-toggle":"tab","data-bs-target":"#clientData",type:"button",role:"tab","aria-controls":"clientData","aria-selected":"true"}," 用戶資料 ")]),t("li",{class:"nav-item col-md-6",role:"presentation"},[t("button",{class:"nav-link w-100 text-dark",id:"profile-tab","data-bs-toggle":"tab","data-bs-target":"#orderProduct",type:"button",role:"tab","aria-controls":"orderProduct","aria-selected":"false"}," 選購商品 ")]),t("li",{class:"nav-item col-md-6",role:"presentation"},[t("button",{class:"nav-link w-100 text-dark",id:"profile-tab","data-bs-toggle":"tab","data-bs-target":"#orderDetail",type:"button",role:"tab","aria-controls":"orderDetail","aria-selected":"false"}," 訂單細節 ")])],-1),F={class:"tab-content",id:"myTabContent"},H={class:"tab-pane fade show active",id:"clientData",role:"tabpanel","aria-labelledby":"home-tab"},z={class:"card my-4 mx-auto"},G={class:"card-body"},J={class:"table-responsive"},K={class:"table align-middle text-center"},Q={key:0},W=t("th",null,"姓名",-1),X=t("th",null,"信箱",-1),Y=t("th",null,"電話",-1),Z=t("th",null,"地址",-1),I={class:"tab-pane fade",id:"orderProduct",role:"tabpanel","aria-labelledby":"profile-tab"},tt={class:"card my-4 mx-auto"},et={class:"card-body"},st={class:"table-responsive"},at={class:"table align-middle text-center text-nowrap"},lt={colspan:"2"},ot=["src"],dt=t("th",null,"項目",-1),nt=t("th",null,"數量",-1),rt=t("th",null,"價格",-1),it={class:"tab-pane fade",id:"orderDetail",role:"tabpanel","aria-labelledby":"profile-tab"},ct={class:"card my-4 mx-auto"},ut={class:"card-body"},ht={class:"table-responsive"},_t={class:"table align-middle text-center"},pt=t("th",null,"訂單編號",-1),mt=t("th",null,"下單時間",-1),bt=t("th",null,"付款時間",-1),gt=t("th",null,"付款狀態",-1),ft={key:0},vt={key:1},yt=t("th",null,"付款狀態",-1),Ot={class:"d-flex justify-content-end"},Dt={key:0,class:"text-success fw-bold"},kt={key:1,class:"text-danger fw-bold"},xt={class:"ms-8"},Mt=t("label",{for:"isPaid",class:"form-check-label text-success"}," 已付 ",-1),$t=t("th",null,"總金額",-1),wt=t("i",{class:"bi bi-cash-coin me-1 text-success fs-4"},null,-1),Lt={class:"modal-footer"},Ct=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消",-1);function Vt(n,s,_,u,e,i){return l(),o("div",A,[t("div",R,[t("div",B,[N,t("div",j,[q,t("div",F,[t("div",H,[t("div",z,[t("div",G,[t("div",J,[t("table",K,[e.tempOrderData.user?(l(),o("tbody",Q,[t("tr",null,[W,t("td",null,a(e.tempOrderData.user.name),1)]),t("tr",null,[X,t("td",null,a(e.tempOrderData.user.email),1)]),t("tr",null,[Y,t("td",null,a(e.tempOrderData.user.tel),1)]),t("tr",null,[Z,t("td",null,a(e.tempOrderData.user.address),1)])])):v("",!0)])])])])]),t("div",I,[t("div",tt,[t("div",et,[t("div",st,[t("table",at,[(l(!0),o(h,null,y(e.tempOrderData.products,r=>(l(),o("tbody",{key:r.id},[t("tr",null,[t("td",lt,[t("img",{src:r.product.imageUrl,width:"350",class:"img-thumbnail my-3"},null,8,ot)])]),t("tr",null,[dt,t("td",null,a(r.product.title),1)]),t("tr",null,[nt,t("td",null,a(r.qty),1)]),t("tr",null,[rt,t("td",null,a(r.total),1)])]))),128))])])])])]),t("div",it,[t("div",ct,[t("div",ut,[t("div",ht,[t("table",_t,[t("tbody",null,[t("tr",null,[pt,t("td",null,a(e.tempOrderData.id),1)]),t("tr",null,[mt,t("td",null,a(n.$filters.date(e.tempOrderData.create_at)),1)]),t("tr",null,[bt,t("td",null,a(n.$filters.date(e.tempOrderData.create_at)),1)]),t("tr",null,[gt,t("td",null,[e.tempOrderData.paid_date?(l(),o("span",ft,a(n.$filters.date(e.tempOrderData.paid_date)),1)):(l(),o("span",vt," 時間不確定 "))])]),t("tr",null,[yt,t("td",Ot,[e.tempOrderData.is_paid?(l(),o("span",Dt,"已付款")):(l(),o("span",kt,"未付款")),t("div",xt,[x(t("input",{type:"checkbox",class:"form-check-input border border-success me-1","onUpdate:modelValue":s[0]||(s[0]=r=>e.tempOrderData.is_paid=r),"true-value":!0,"false-value":!1,id:"isPaid"},null,512),[[M,e.tempOrderData.is_paid]]),Mt])])]),t("tr",null,[$t,t("td",null,[wt,O(" "+a(e.tempOrderData.total)+" 元",1)])])])])])])])])])]),t("div",Lt,[Ct,t("button",{type:"button",class:"btn btn-warning",onClick:s[1]||(s[1]=f(r=>_.updateOrderModal(e.tempOrderData),["prevent"]))}," 修改付款狀態 ")])])])],512)}const Tt=k(U,[["render",Vt]]);var Pt={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"getmarried",BASE_URL:"/vite_week8_20240324/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:b,VITE_PATH:g}=Pt,Et={components:{orderModal:Tt,DelModal:E,PaginationComponent:S},data(){return{isLoading:!1,remoteOrders:[],tempOrder:{},pagination:[]}},methods:{...C(T,["pushMessage"]),getOrders(n=1){this.isLoading=!0,this.$http(`${b}/api/${g}/admin/orders?page=${n}`).then(s=>{this.isLoading=!1,this.remoteOrders=s.data.orders,this.pagination=s.data.pagination}).catch(s=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"取得失敗",content:s.response.data.message})})},openModal(n,s){n==="view"?(this.tempOrder={...s},this.$refs.orderModal.show()):(this.tempOrder={...s},this.$refs.delModal.show())},updateOrder(n){this.tempOrder=n;const s=`${b}/api/${g}/admin/order/${this.tempOrder.id}`,_={is_paid:this.tempOrder.is_paid};this.isLoading=!0,this.$http.put(s,{data:_}).then(u=>{this.isLoading=!1,this.$refs.orderModal.hide(),this.getOrders(),this.pushMessage({style:"success",title:"訂單狀態",content:u.data.message})}).catch(u=>{this.isLoading=!1,this.$refs.orderModal.hide(),this.pushMessage({style:"danger",title:"訂單狀態",content:u.response.data.message})})},delOrder(n){this.tempOrder=n,this.isLoading=!0,this.$http.delete(`${b}/api/${g}/admin/order/${this.tempOrder.id}`).then(()=>{this.isLoading=!1,this.$refs.delModal.hide(),this.getOrders()}).catch(s=>{this.isLoading=!1,this.$refs.delModal.hide(),this.pushMessage({style:"danger",title:"錯誤訊息",content:s.response.data.message})})},delOrders(){this.$http.delete(`${b}/api/${g}/admin/orders/all`).then(()=>{D.fire("訂單已全部刪除囉!").then(()=>{this.getOrders()})}).catch(()=>{D.fire("訂單刪除失敗唷!")})}},mounted(){this.getOrders()}},St={class:"container"},Ut={class:"p-lg-4 py-4 px-2"},At={class:"card"},Rt={key:0,class:"deleteAll position-absolute top-0 end-0"},Bt={class:"card-body"},Nt={class:"table-responsive"},jt={class:"table align-middle text-nowrap"},qt=t("thead",null,[t("tr",null,[t("th",null,"購買時間"),t("th",null,"信箱"),t("th",null,"購買款項"),t("th",null,"應付金額"),t("th",null,"是否付款"),t("th",{class:"text-center"},"編輯")])],-1),Ft={class:"list-unstyled"},Ht={class:"form-check form-switch"},zt=["onUpdate:modelValue","onChange","id"],Gt=["for"],Jt={key:0,class:"text-success"},Kt={key:1,class:"text-danger"},Qt={class:"d-flex justify-content-center"},Wt=["onClick"],Xt=t("i",{class:"bi bi-eye"},null,-1),Yt=["onClick"],Zt=t("i",{class:"bi bi-trash-fill"},null,-1),It={class:"card-footer bg-transparent p-3"};function te(n,s,_,u,e,i){const r=p("VLoading"),$=p("orderModal"),w=p("DelModal"),L=p("PaginationComponent");return l(),o(h,null,[m(r,{active:e.isLoading},null,8,["active"]),m($,{ref:"orderModal",orderData:e.tempOrder,"update-order-modal":i.updateOrder},null,8,["orderData","update-order-modal"]),m(w,{ref:"delModal","item-modal":e.tempOrder,"del-product":i.delOrder},null,8,["item-modal","del-product"]),t("div",St,[t("div",Ut,[t("div",At,[e.remoteOrders.length>10?(l(),o("div",Rt,[t("button",{class:"btn btn-outline-danger",type:"button",onClick:s[0]||(s[0]=f((...d)=>i.delOrders&&i.delOrders(...d),["prevent"]))}," 刪除全訂單 ")])):v("",!0),t("div",Bt,[t("div",Nt,[t("table",jt,[qt,t("tbody",null,[(l(!0),o(h,null,y(e.remoteOrders,d=>(l(),o(h,{key:d.id},[e.remoteOrders.length?(l(),o("tr",{key:0,class:V({"text-secondary":!d.is_paid})},[t("td",null,a(n.$filters.date(d.create_at)),1),t("td",null,a(d.user.email),1),t("td",null,[t("ul",Ft,[(l(!0),o(h,null,y(d.products,c=>(l(),o("li",{key:c.id},a(c.product.title)+" 數量："+a(c.qty)+" "+a(c.product.unit),1))),128))])]),t("td",null,a(d.total),1),t("td",null,[t("div",Ht,[x(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":c=>d.is_paid=c,onChange:c=>i.updateOrder(d),id:`${d.id}`},null,40,zt),[[M,d.is_paid]]),t("label",{class:"form-check-label",for:`${d.id}`},[d.is_paid?(l(),o("span",Jt,"已付款")):(l(),o("span",Kt,"未付款"))],8,Gt)])]),t("td",null,[t("div",Qt,[t("button",{class:"btn btn-outline-warning btn-sm me-2",type:"button",onClick:f(c=>i.openModal("view",d),["prevent"])},[Xt,O(" 檢視 ")],8,Wt),t("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:f(c=>i.openModal("delete",d),["prevent"])},[Zt,O(" 刪除 ")],8,Yt)])])],2)):v("",!0)],64))),128))])])])]),t("div",It,[m(L,{pages:e.pagination,"get-products":i.getOrders},null,8,["pages","get-products"])])])])])],64)}const ne=k(Et,[["render",te]]);export{ne as default};

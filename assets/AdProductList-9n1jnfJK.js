import{m as V,_ as C,o as l,c as i,a as t,j as r,k as u,l as U,h as P,w as h,F as x,g as w,b as m,r as g,d as _,e as L,t as f}from"./index-6BvTerDF.js";import{T as D}from"./ToastMessage-QFYtcSDc.js";import{u as T}from"./statusStore-N0jbiZgM.js";import{P as R}from"./PaginationView-VIKG9F-S.js";import{m as A}from"./modal-zhVd5Gm4.js";import{D as F}from"./DelModal--U7SkCiH.js";var j={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"getmarried",BASE_URL:"/vite_week8_20240324/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:I,VITE_PATH:z}=j,B={props:["productModal","isStatus","updateProduct"],mixins:[A],data(){return{tempProductModal:{}}},watch:{productModal(){this.tempProductModal=this.productModal}},methods:{...V(T,["pushMessage"]),uploadFile(n){const e=n.target.files[0],a=new FormData;a.append("file-to-upload",e),this.$http.post(`${I}/api/${z}/admin/upload`,a).then(p=>{this.tempProductModal.imageUrl=p.data.imageUrl,this.$refs.inputFile.value="",this.pushMessage({style:"success",title:"圖片上傳結果",content:p.data.message})}).catch(p=>{this.pushMessage({style:"danger",title:"圖片上傳結果",content:p.response.data.message})})}}},H={class:"modal fade",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},N={class:"modal-dialog modal-lg modal-dialog-scrollable"},O={class:"modal-content"},q={key:0,class:"modal-header bg-lilac"},G=t("h1",{class:"modal-title fs-5 text-white",id:"exampleModalLabel"}," 新增產品 ",-1),J=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),K=[G,J],Q={key:1,class:"modal-header bg-warning"},W=t("h1",{class:"modal-title fs-5 text-white",id:"exampleModalLabel"}," 編輯產品 ",-1),X=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Y=[W,X],Z={class:"modal-body pb-0"},tt=t("ul",{class:"nav nav-tabs row",id:"myTab",role:"tablist"},[t("li",{class:"nav-item col-md-6",role:"presentation"},[t("button",{class:"nav-link active w-100 text-dark",id:"home-tab","data-bs-toggle":"tab","data-bs-target":"#itemContent",type:"button",role:"tab","aria-controls":"home","aria-selected":"true"},"商品內容")]),t("li",{class:"nav-item col-md-6",role:"presentation"},[t("button",{class:"nav-link w-100 text-dark",id:"profile-tab","data-bs-toggle":"tab","data-bs-target":"#itemImg",type:"button",role:"tab","aria-controls":"profile","aria-selected":"false"},"商品圖片")])],-1),et={class:"tab-content",id:"myTabContent"},st={class:"tab-pane fade show active",id:"itemContent",role:"tabpanel","aria-labelledby":"home-tab"},ot={class:"my-4"},lt={class:"row"},it={class:"col-md-10"},at={class:"mb-3"},dt=t("label",{for:"category",class:"form-label d-flex align-items-start"},[m(" 分類"),t("i",{class:"bi bi-asterisk text-danger ms-1",style:{"font-size":"8px"}})],-1),nt={class:"col-md-2 d-flex align-items-end"},ct={class:"form-check mb-3 d-none d-lg-block"},rt=t("label",{for:"enabled",class:"form-check-label"}," 是否啟用 ",-1),ut={class:"col-md-6"},pt={class:"mb-3"},mt=t("label",{for:"title",class:"form-label d-flex align-items-start"},[m(" 標題"),t("i",{class:"bi bi-asterisk text-danger ms-1",style:{"font-size":"8px"}})],-1),ht={class:"col-md-6"},_t={class:"mb-3"},bt=t("label",{for:"unit",class:"form-label d-flex align-items-start"},[m(" 單位"),t("i",{class:"bi bi-asterisk text-danger ms-1",style:{"font-size":"8px"}})],-1),gt={class:"col-md-6"},ft={class:"mb-3"},vt=t("label",{for:"origin_price",class:"form-label d-flex align-items-start"},[m(" 原價"),t("i",{class:"bi bi-asterisk text-danger ms-1",style:{"font-size":"8px"}})],-1),Pt={class:"col-md-6"},yt={class:"mb-3"},Mt=t("label",{for:"price",class:"form-label d-flex align-items-start"},[m(" 售價"),t("i",{class:"bi bi-asterisk text-danger ms-1",style:{"font-size":"8px"}})],-1),xt={class:"col-md-6"},wt={class:"mb-3"},kt=t("label",{for:"description",class:"form-label"}," 產品描述 ",-1),Ut={class:"col-md-6"},Lt={class:"mb-3"},Vt=t("label",{for:"content",class:"form-label"}," 產品內容 ",-1),Ct={class:"col-md-12 d-block d-lg-none d-flex justify-content-end"},Tt={class:"form-check mb-3"},$t=t("label",{for:"enabled",class:"form-check-label"}," 是否啟用 ",-1),Et={class:"tab-pane fade",id:"itemImg",role:"tabpanel","aria-labelledby":"profile-tab"},St={class:"my-4"},Dt={class:"row g-md-4 g-3"},Rt={class:"col-md-6"},At={class:"row"},Ft={class:"col-md-6"},jt={class:"mb-3"},It=t("label",{for:"majorImg",class:"form-label"}," 輸入主要圖片網址 ",-1),zt={class:"col-md-6"},Bt={class:"mb-3"},Ht=t("label",{for:"upImg",class:"form-label"}," 或 上傳圖片 ",-1),Nt=["src"],Ot={class:"col-md-6"},qt={key:0},Gt={class:"my-3"},Jt={class:"row g-3"},Kt=["onUpdate:modelValue"],Qt=["src"],Wt=["onClick"],Xt={class:"modal-footer"},Yt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Zt(n,e,a,p,s,c){return l(),i("div",H,[t("div",N,[t("div",O,[a.isStatus?(l(),i("div",q,K)):(l(),i("div",Q,Y)),t("div",Z,[tt,t("div",et,[t("div",st,[t("div",ot,[t("div",lt,[t("div",it,[t("div",at,[dt,r(t("input",{type:"text",class:"form-control",id:"category",placeholder:"請輸入分類","onUpdate:modelValue":e[0]||(e[0]=o=>s.tempProductModal.category=o)},null,512),[[u,s.tempProductModal.category]])])]),t("div",nt,[t("div",ct,[r(t("input",{type:"checkbox",class:"form-check-input",id:"enabled","onUpdate:modelValue":e[1]||(e[1]=o=>s.tempProductModal.is_enabled=o),"true-value":1,"false-value":0},null,512),[[U,s.tempProductModal.is_enabled]]),rt])]),t("div",ut,[t("div",pt,[mt,r(t("input",{type:"text",class:"form-control",id:"title",placeholder:"請輸入標題","onUpdate:modelValue":e[2]||(e[2]=o=>s.tempProductModal.title=o)},null,512),[[u,s.tempProductModal.title]])])]),t("div",ht,[t("div",_t,[bt,r(t("input",{type:"text",class:"form-control",id:"unit",placeholder:"請輸入單位","onUpdate:modelValue":e[3]||(e[3]=o=>s.tempProductModal.unit=o)},null,512),[[u,s.tempProductModal.unit]])])]),t("div",gt,[t("div",ft,[vt,r(t("input",{type:"number",class:"form-control",id:"origin_price",placeholder:"請輸入原價",min:"0","onUpdate:modelValue":e[4]||(e[4]=o=>s.tempProductModal.origin_price=o)},null,512),[[u,s.tempProductModal.origin_price,void 0,{number:!0}]])])]),t("div",Pt,[t("div",yt,[Mt,r(t("input",{type:"number",class:"form-control",id:"price",placeholder:"請輸入售價",min:"0","onUpdate:modelValue":e[5]||(e[5]=o=>s.tempProductModal.price=o)},null,512),[[u,s.tempProductModal.price,void 0,{number:!0}]])])]),t("div",xt,[t("div",wt,[kt,r(t("textarea",{id:"description",rows:"3",class:"form-control","onUpdate:modelValue":e[6]||(e[6]=o=>s.tempProductModal.description=o)},null,512),[[u,s.tempProductModal.description]])])]),t("div",Ut,[t("div",Lt,[Vt,r(t("textarea",{id:"content",rows:"3",class:"form-control","onUpdate:modelValue":e[7]||(e[7]=o=>s.tempProductModal.content=o)},null,512),[[u,s.tempProductModal.content]])])]),t("div",Ct,[t("div",Tt,[r(t("input",{type:"checkbox",class:"form-check-input",id:"enabled","onUpdate:modelValue":e[8]||(e[8]=o=>s.tempProductModal.is_enabled=o),"true-value":1,"false-value":0},null,512),[[U,s.tempProductModal.is_enabled]]),$t])])])])]),t("div",Et,[t("div",St,[t("div",Dt,[t("div",Rt,[t("div",At,[t("div",Ft,[t("div",jt,[It,r(t("input",{type:"text",class:"form-control",id:"majorImg",placeholder:"輸入圖片網址","onUpdate:modelValue":e[9]||(e[9]=o=>s.tempProductModal.imageUrl=o)},null,512),[[u,s.tempProductModal.imageUrl]])])]),t("div",zt,[t("div",Bt,[Ht,t("input",{type:"file",class:"form-control",id:"upImg",ref:"inputFile",onChange:e[10]||(e[10]=(...o)=>c.uploadFile&&c.uploadFile(...o))},null,544)])])]),s.tempProductModal.imageUrl?(l(),i("img",{key:0,src:s.tempProductModal.imageUrl,class:"img-thumbnail"},null,8,Nt)):P("",!0)]),t("div",Ot,[Array.isArray(s.tempProductModal.imagesUrl)?(l(),i("div",qt,[!s.tempProductModal.imagesUrl.length||s.tempProductModal.imagesUrl[s.tempProductModal.imagesUrl.length-1]?(l(),i("button",{key:0,class:"btn btn-sm btn-outline-lilac w-100",onClick:e[11]||(e[11]=h(o=>s.tempProductModal.imagesUrl.push(""),["prevent"])),type:"button"},"新增多圖片 ")):P("",!0),t("div",Gt,[t("div",Jt,[(l(!0),i(x,null,w(s.tempProductModal.imagesUrl,(o,b)=>(l(),i("div",{class:"col-md-6",key:b},[r(t("input",{type:"text",class:"form-control",placeholder:"輸入圖片網址","onUpdate:modelValue":v=>s.tempProductModal.imagesUrl[b]=v},null,8,Kt),[[u,s.tempProductModal.imagesUrl[b]]]),o?(l(),i("img",{key:0,src:o,alt:"",class:"img-thumbnail"},null,8,Qt)):P("",!0),t("button",{class:"btn btn-sm btn-outline-danger w-100",onClick:h(v=>s.tempProductModal.imagesUrl.splice(b,1),["prevent"]),type:"button"},"刪除圖片 ",8,Wt)]))),128))])])])):P("",!0)])])])])])]),t("div",Xt,[Yt,a.isStatus?(l(),i("button",{key:0,type:"button",class:"btn btn-lilac text-white",onClick:e[12]||(e[12]=h(o=>a.updateProduct(s.tempProductModal),["prevent"]))}," 新增 ")):(l(),i("button",{key:1,type:"button",class:"btn btn-warning text-white",onClick:e[13]||(e[13]=h(o=>a.updateProduct(s.tempProductModal),["prevent"]))}," 編輯 "))])])])],512)}const te=C(B,[["render",Zt]]);var ee={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"getmarried",BASE_URL:"/vite_week8_20240324/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:y,VITE_PATH:M}=ee,se={components:{ToastMessages:D,PaginationComponent:R,ProductListModal:te,DelModal:F},data(){return{isLoading:!1,categories:["攝影師","新娘秘書","主持人","婚宴場","禮車","音樂","道具"],remoteProducts:[],search:"",isStatus:!1,tempProduct:{imagesUrl:[]},pagination:[]}},watch:{"$route.query":{handler(){this.getProducts()},deep:!0}},computed:{filterData(){return this.remoteProducts.filter(n=>n.category.match(this.search))}},methods:{...V(T,["pushMessage"]),getProducts(n=1){const{category:e=""}=this.$route.query;this.isLoading=!0,this.$http(`${y}/api/${M}/admin/products?page=${n}&category=${e}`).then(a=>{this.remoteProducts=a.data.products,this.pagination=a.data.pagination,this.isLoading=!1,this.pushMessage({style:"success",title:"成功取得產品",content:a.data.message})}).catch(a=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"無法取得產品",content:a.responsive.data.message})})},openModal(n,e){n==="new"?(this.tempProduct={imagesUrl:[]},this.isStatus=!0,this.$refs.pList.show()):n==="edit"?(this.tempProduct={...e},this.isStatus=!1,this.$refs.pList.show()):n==="delete"&&(this.tempProduct={...e},this.$refs.dModal.show())},updateProduct(n){this.tempProduct=n;let e=`${y}/api/${M}/admin/product`,a="post",p="新增產品";this.isStatus||(e=`${y}/api/${M}/admin/product/${this.tempProduct.id}`,a="put",p="編輯產品"),this.isLoading=!0,this.$http[a](e,{data:this.tempProduct}).then(s=>{this.isLoading=!1,this.$refs.pList.hide(),this.getProducts(),this.pushMessage({style:"success",title:p,content:s.data.message})}).catch(s=>{this.isLoading=!1,this.$refs.pList.hide(),this.pushMessage({style:"danger",title:"錯誤訊息",content:s.response.data.message})})},delProduct(n){this.tempProduct=n,this.isLoading=!0,this.$http.delete(`${y}/api/${M}/admin/product/${this.tempProduct.id}`).then(e=>{this.isLoading=!1,this.$refs.dModal.hide(),this.getProducts(),this.pushMessage({style:"success",title:"刪除成功",content:e.data.message})}).catch(e=>{this.isLoading=!1,this.$refs.dModal.hide(),this.pushMessage({style:"success",title:"刪除失敗",content:e.response.data.message})})}},mounted(){this.getProducts()}},oe={class:"container"},le={class:"p-lg-4 py-4 px-2"},ie={class:"card"},ae={class:"card-header bg-transparent p-3"},de={class:"row row-cols-lg-2 row-cols-1 g-3 align-items-center"},ne={class:"col"},ce=t("div",{class:"card-title fw-bold"}," 關鍵字搜尋： ",-1),re={class:"row row-cols-lg-4 px-2 row-cols-3 text-nowrap"},ue={class:"col p-0"},pe={class:"col"},me={class:"row p-2 justify-content-end align-items-center"},he={class:"col-lg-5 col-8 p-0"},_e={class:"input-group input-group-sm"},be=t("span",{class:"input-group-text bg-transparent border border-end-0"},[t("i",{class:"bi bi-search text-lilac"})],-1),ge={class:"col-lg-3 col-4 d-flex justify-content-center p-0"},fe={class:"card-body"},ve={class:"table-responsive"},Pe={class:"table align-middle text-nowrap text-center"},ye=t("thead",null,[t("tr",null,[t("th",null,"縮圖"),t("th",null,"分類"),t("th",null,"名稱"),t("th",null,"原價"),t("th",null,"售價"),t("th",null,"是否啟用"),t("th",null,"編輯")])],-1),Me={style:{width:"200px","min-width":"120px"}},xe=["src"],we={key:0,class:"text-success"},ke={key:1,class:"text-danger"},Ue={class:"d-flex justify-content-center"},Le=["onClick"],Ve=t("i",{class:"bi bi-pen-fill"},null,-1),Ce=["onClick"],Te=t("i",{class:"bi bi-trash-fill"},null,-1),$e={class:"card-footer bg-transparent p-3"};function Ee(n,e,a,p,s,c){const o=g("VLoading"),b=g("ToastMessages"),v=g("ProductListModal"),$=g("DelModal"),k=g("RouterLink"),E=g("PaginationComponent");return l(),i(x,null,[_(o,{active:s.isLoading},null,8,["active"]),_(b),_(v,{ref:"pList","product-modal":s.tempProduct,"is-status":s.isStatus,"update-product":c.updateProduct},null,8,["product-modal","is-status","update-product"]),_($,{ref:"dModal","item-modal":s.tempProduct,"del-product":c.delProduct},null,8,["item-modal","del-product"]),t("div",oe,[t("div",le,[t("div",ie,[t("div",ae,[t("div",de,[t("div",ne,[ce,t("div",re,[t("div",ue,[_(k,{class:"btn btn-outline-lilac w-100",type:"button",to:"/admin/adProducts/adProductList"},{default:L(()=>[m(" 全部 ")]),_:1})]),(l(!0),i(x,null,w(s.categories,d=>(l(),i("div",{class:"col p-0",key:d},[_(k,{class:"btn btn-outline-lilac w-100",type:"button",to:`/admin/adProducts/adProductList?category=${d}`},{default:L(()=>[m(f(d),1)]),_:2},1032,["to"])]))),128))])]),t("div",pe,[t("div",me,[t("div",he,[t("div",_e,[be,r(t("input",{type:"search",class:"form-control border border-start-0 ps-0 shadow-none",placeholder:"找無資料需換頁搜尋","onUpdate:modelValue":e[0]||(e[0]=d=>s.search=d)},null,512),[[u,s.search]])])]),t("div",ge,[t("button",{class:"btn btn-lilac text-nowrap btn-sm d-xl-none d-block",type:"button",onClick:e[1]||(e[1]=h(d=>c.openModal("new"),["prevent"]))},"新增資訊"),t("button",{class:"btn btn-lilac text-nowrap d-xl-block d-none fw-bold",type:"button",onClick:e[2]||(e[2]=h(d=>c.openModal("new"),["prevent"]))},"新增資訊")])])])])]),t("div",fe,[t("div",ve,[t("table",Pe,[ye,t("tbody",null,[(l(!0),i(x,null,w(c.filterData,d=>(l(),i("tr",{key:d.id},[t("td",Me,[t("div",null,[t("img",{src:d.imageUrl,alt:"",class:"img-thumbnail"},null,8,xe)])]),t("th",null,f(d.category),1),t("td",null,f(d.title),1),t("td",null,f(d.origin_price),1),t("td",null,f(d.price),1),t("td",null,[d.is_enabled?(l(),i("span",we,"啟用")):(l(),i("span",ke,"未啟用"))]),t("td",null,[t("div",Ue,[t("button",{class:"btn btn-outline-warning me-2 btn-sm",type:"button",onClick:h(S=>c.openModal("edit",d),["prevent"])},[Ve,m(" 編輯 ")],8,Le),t("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:h(S=>c.openModal("delete",d),["prevent"])},[Te,m(" 刪除 ")],8,Ce)])])]))),128))])])])]),t("div",$e,[_(E,{pages:s.pagination,"get-products":c.getProducts,onChangePage:c.getProducts},null,8,["pages","get-products","onChangePage"])])])])])],64)}const Ie=C(se,[["render",Ee]]);export{Ie as default};
